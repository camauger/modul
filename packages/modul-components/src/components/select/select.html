<m-base-select class="m-select"
               :class="{ 'm--is-open': open,
                'm--is-disabled': disabled,
                'm--is-readonly': readonly,
                'm--is-waiting': waiting,
                'm--has-validation-message': hasValidationMessage }"
               :control-id="id"
               :active="!disabled && !readonly"
               :items="options"
               :selected-items="selectedItems"
               :open.sync="open"
               :input-max-width="inputMaxWidth"
               :virtual-scroll="virtualScroll"
               :virtual-scroll-item-height="virtualScrollItemHeight"
               @open="onOpen"
               @close="onClose"
               @select-item="onSelect"
               ref="baseSelect">
    <template v-slot:default="scope">
        <m-input-style :label="label"
                       :label-for="id"
                       :disabled="disabled"
                       :readonly="readonly"
                       :waiting="waiting"
                       :focus="internalIsFocus || open"
                       :label-up="labelUp"
                       :empty="isEmpty"
                       :error="hasError"
                       :cursor-pointer="isSelectable"
                       :append="true"
                       :valid="isValid"
                       :required-marker="requiredMarker"
                       :tag-style="tagStyle"
                       :width="inputWidth"
                       :max-width="inputMaxWidth"
                       @click="toggleOpen()">
            <div>
                <slot :key-up="scope.keyUp"
                      :key-down="scope.keyDown"
                      :key-tab="scope.keyTab"
                      :key-esc="scope.keyEsc"
                      :key-enter="scope.keyEnter"
                      :key-space="scope.keySpace"
                      :focus="onFocus"
                      :blur="onBlur">
                    <input v-model="internalValue"
                           :placeholder="placeholder"
                           :disabled="disabled"
                           :readonly="true"
                           @focus="onFocus"
                           @blur="onBlur"
                           @keydown.up.prevent="scope.keyUp"
                           @keydown.down.prevent="scope.keyDown"
                           @keydown.enter.prevent="scope.keyEnter"
                           @keydown.return.prevent="scope.keyEnter"
                           @keydown.esc="scope.keyEsc"
                           @keydown.tab="scope.keyTab"
                           @keydown.space="scope.keySpace"
                           @keydown.delete="onKeyDownDelete"
                           ref="input">
                </slot>
            </div>
            <template v-slot:suffix>
                <m-opacity-transition>
                    <m-icon v-if="isClearable"
                            class="m-select__icon-clear"
                            key="resetIcon"
                            size="12px"
                            name="m-svg__close-clear"
                            :aria-controls="id"
                            @click.stop="onReset"></m-icon>
                </m-opacity-transition>

                <div class="m-select__icon"
                     :class="{ 'm--is-open': open }">
                    <m-icon class="m-select__icon-arrow"
                            :title="iconArrowTitle"
                            :disabled="disabled"
                            name="m-svg__arrow-head-filled--down"
                            size="12px"
                            @keydown.enter.prevent="open = !disabled && !readonly"
                            ref="arrow">
                    </m-icon>
                </div>
            </template>
        </m-input-style>
    </template>
    <m-validation-message slot="validation-message"
                          class="m-select__validation-message"
                          :disabled="disabled"
                          :waiting="waiting"
                          :error="hasError"
                          :valid="isValid"
                          :error-message="errorMessage"
                          :valid-message="validMessage"
                          :helper-message="helperMessage"></m-validation-message>
    <template v-slot:items="{item , index }">
        <slot name="items"
              :item="item"
              :index="index"><span v-html="item"></span></slot>
    </template>
</m-base-select>
